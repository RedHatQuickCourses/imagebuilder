<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Red Hat Enterprise Linux: Create System Images Using Image Builder</title>
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Red Hat Enterprise Linux: Create System Images Using Image Builder</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/imagebuilder/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="imagebuilder" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Red Hat Enterprise Linux: Create System Images Using Image Builder</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">index.adoc</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section1.html">section1.adoc</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section2.html">section2.adoc</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section3.html">section3.adoc</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter2/index.html">Chapter 2</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter2/section1.html">Section 1</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter3/index.html">Chapter 3</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter3/section1.html">Section 1</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter3/section2.html">Section 2</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/appendix.html">Appendix</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Red Hat Enterprise Linux: Create System Images Using Image Builder</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Red Hat Enterprise Linux: Create System Images Using Image Builder</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect1">
<h2 id="_creating_blueprints_and_images"><a class="anchor" href="#_creating_blueprints_and_images"></a>Creating blueprints and images</h2>
<div class="sectionbody">

</div>
</div>
<h1 id="_create_and_customize_blueprints_via_the_web_console" class="sect0"><a class="anchor" href="#_create_and_customize_blueprints_via_the_web_console"></a>Create and customize blueprints via the web console</h1>
<div class="paragraph">
<p>When an application needs to be added to an infrastructure, you can use image builder to design a single system to deploy that application, and to generate corresponding images.</p>
</div>
<div class="paragraph">
<p>The feature that holds that customized plan for the system is called a <code>blueprint</code>.</p>
</div>
<div class="paragraph">
<p>A blueprint is a list of preselected components for a system that forms the template for a custom image. Some components are packages or software groups.</p>
</div>
<div class="paragraph">
<p>You can create multiple images in multiple supported formats from the same blueprint. A blueprint saves a record of the inputs and instructions for an image build so it can be reproduced later.</p>
</div>
<div class="paragraph">
<p>The screenshot on this page shows what the list of blueprints looks like in the web console interface. The <strong>Image Builder</strong> navigation sidebar option presents an overview.</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="_images/ch5.1.png" alt="ch5.1">
</div>
</div>
<div class="paragraph">
<p>Click <strong>Create Blueprint</strong> in the image builder interface to open the page shown in the screenshot here.</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="_images/ch5.2.png" alt="ch5.2">
</div>
</div>
<div class="paragraph">
<p>On this page, you can select components to customize the system. A component can be RPM packages or kernel customizations.</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="_images/ch5.3.png" alt="ch5.3">
</div>
</div>
<div class="paragraph">
<p>After making your selections, you save the new blueprint. From here, you can edit the blueprint as needed without starting over, including adding and removing components.</p>
</div>
<div class="paragraph">
<p><strong>Create images</strong></p>
</div>
<div class="paragraph">
<p>After creating a blueprint, you can create images based on that blueprint. The previous section, which show screenshots of viewing and editing a blueprint, show the button for building an image from the selected blueprint.</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="_images/ch5.4.png" alt="ch5.4">
</div>
</div>
<div class="paragraph">
<p>Image builder allows building any of the supported image types mentioned earlier from a blueprint. The screenshot here shows selecting the output file format for the image you want to build.</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="_images/ch5.5.png" alt="ch5.5">
</div>
</div>
<h1 id="_blueprint_customization_by_using_the_cli" class="sect0"><a class="anchor" href="#_blueprint_customization_by_using_the_cli"></a>Blueprint customization by using the CLI</h1>
<div class="paragraph">
<p>To customize a blueprint from the CLI:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To add a user to the weldr or root groups, run the following commands:</p>
<div class="literalblock">
<div class="content">
<pre># sudo usermod -a -G weldr &lt;user&gt;
# newgrp weldr</pre>
</div>
</div>
</li>
<li>
<p>Download a copy of the blueprint configuration file from image builder:</p>
<div class="literalblock">
<div class="content">
<pre># composer-cli blueprints save &lt;blueprint-name&gt;</pre>
</div>
</div>
</li>
<li>
<p>Edit that file using any file editor of your choice. The file name ends with toml extenstion (example: blueprint-name.toml).</p>
</li>
<li>
<p>Push the revised blueprint configuration file back to image builder:</p>
<div class="literalblock">
<div class="content">
<pre># composer-cli blueprints push &lt;blueprint-name.toml&gt;</pre>
</div>
</div>
</li>
<li>
<p>Verify that your changes appear in the configuration file using this command:</p>
<div class="literalblock">
<div class="content">
<pre># composer-cli blueprints show &lt;blueprint-name&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Blueprint configuration files follow TOML (Tom&#8217;s Obvious, Minimal Language) format, which uses key/value pairs. For more information, see TOML on GitHub at <a href="https://github.com/toml-lang/toml">Github Toml</a></p>
</div>
<div class="paragraph">
<p><strong>Adding SSH keys for a user</strong></p>
</div>
<div class="paragraph">
<p>Append lines to the blueprint configuration file to add SSH keys for a user.</p>
</div>
<div class="paragraph">
<p>SSH keys for the root user:
  [
 [customizations.sshkey]]
 user = "root"
 key = "&lt;public SSH key&gt;"</p>
</div>
<div class="paragraph">
<p>If you copy the contents of your personal public key file (.ssh/id_rsa.pub) to the value of key, you should be able to use SSH to log in as root on systems launched from the resulting image.</p>
</div>
<div class="paragraph">
<p><strong>Adding users</strong></p>
</div>
<div class="paragraph">
<p>Append lines to the blueprint configuration file to add a new user.</p>
</div>
<div class="paragraph">
<p>New user <code>myuser</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[[customizations.user]]
name = "myuser"
description = &lt;user description&gt;
password = "&lt;password in plain text OR an encrypted password string&gt;"
key = "&lt;public SSH key&gt;"
home = "/home/my-user/"
shell = "/usr/bin/bash"
groups = ["users", "wheel"]
uid = 1001
gid = 1001</pre>
</div>
</div>
<div class="paragraph">
<p>To generate encrypted password string:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># python3 -c "import crypt, getpass; print(crypt.crypt(getpass.getpass(), crypt.METHOD_SHA512))"</pre>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
